create_table :categories do |t|
  t.string :name, null: false

  t.timestamps

  t.index :name, unique: true
end

create_table :categories_products do |t|
  t.belongs_to :category, null: false, foreign_key: true, index: false
  t.belongs_to :product, null: false, foreign_key: true

  t.timestamps

  t.index %i[category_id product_id], unique: true
end

create_table :order_items do |t|
  t.belongs_to :order, null: false, foreign_key: true
  t.belongs_to :product, null: false, foreign_key: true
  t.integer :quantity, null: false, limit: 2, unsigned: true

  t.timestamps
end

create_table :orders do |t|
  t.belongs_to :user, null: false, foreign_key: true
  t.belongs_to :pickup_location, null: false, foreign_key: true
  t.integer :total_amount, null: false
  t.string :minifinancier_payment_id
  t.datetime :ordered_at
  t.datetime :delivery_date
  t.datetime :canceled_at

  t.timestamps

  t.index :minifinancier_payment_id, unique: true
end

create_table :pickup_locations do |t|
  t.string :name, null: false

  t.timestamps
end

create_table :products do |t|
  t.string :name, null: false
  t.string :description, null: false
  t.integer :price, null: false
  t.string :image_path, null: false

  t.timestamps
end

create_table :users do |t|
  t.belongs_to :pickup_location, foreign_key: true
  t.string :name, null: false

  t.timestamps

  t.index :name, unique: true
end
